sudo:     required
language: go
go:       "1.13"
services:
- docker
- redis-server
before_install: sudo apt-get update -y && sudo apt-get install stunnel4 -y
install: make bootstrap_redis_tls
before_script:
- redis-server --port 6380 &
- redis-server --port 6381 --requirepass password123 &
- redis-server --port 6382 --requirepass password123 &
script: make check_format tests docker_build
jobs:
  include:
  - stage: test
  - stage: release
    if: tag IS present && !fork
    script: skip
    deploy:
      provider: script
      script: make docker_build dockerhub_push

